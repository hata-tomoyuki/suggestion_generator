# 要件定義書
## 見積もり → 提案書 一気通貫ジェネレーター
（Next.js 最新機能フル活用）

---

## 1. 目的・背景

### 1.1 背景
Webアプリ開発案件において、

- 見積作成
- 提案書作成
- 社内レビュー
- 承認（PM・営業）
- 顧客共有・PDF提出

が属人化・分断しており、
「修正漏れ」「承認フローの停滞」「WebとPDFの差分」などの課題が発生している。

### 1.2 目的
本システムは、

- 見積
- 提案書
- レビュー
- 承認
- 共有

を **1つのUI・1つのURL構造で完結** させ、
チームで再現性のある提案業務を実現することを目的とする。

---

## 2. 想定ユーザー・利用形態

### 2.1 想定ユーザー
Webアプリ開発を行う制作・開発チーム。

| 役割 | 権限概要 |
|---|---|
| Admin | 全権限 |
| Editor | 作成・編集・レビュー対応 |
| Viewer | 閲覧のみ |
| PM承認者 | PM承認 |
| 営業承認者 | 営業承認 |

### 2.2 利用形態
- チーム内での共同編集・レビュー
- 顧客への Web 共有および PDF 提出

---

## 3. 対象案件・前提条件

- 対象案件：**Webアプリケーション開発中心**
- 見積単位：**人日（1人日 = 8h）**
- 人日刻み：**0.25日刻み**
- 単価：**ロール単価（PM / Dev / Design）**
- 提案書テンプレ：**小 / 中 / 大（開発規模）**
- 出力：**Web共有 + PDF必須**

---

## 4. システム全体像

### 4.1 基本構成
1案件につき、1画面内で以下を同時表示する。

- 要件入力
- 提案書プレビュー
- 見積・承認サイドバー
- 編集・レビュー用モーダル

### 4.2 採用技術思想
- Next.js App Router
- Parallel Routes（同一URL内の複数UI）
- Intercepting Routes（モーダル駆動UI）
- Server Actions（保存・承認・生成）
- use cache（見積・提案生成の高速化）

---

## 5. 画面・ルーティング要件

### 5.1 主要URL
- `/quotes`：案件一覧
- `/quotes/new`：新規作成
- `/quotes/[id]`：編集・レビュー中心画面
- `/quotes/share/[token]`：顧客共有（期限・パスワード付）
- `/quotes/[id]/print`：PDF生成用HTML

### 5.2 `/quotes/[id]` の Parallel Routes
- `@form`：要件入力
- `@preview`：提案書プレビュー
- `@side`：見積・承認・共有・PDF
- `@modal`：編集・コメント・承認者変更

---

## 6. 要件入力仕様（概要）

### 6.1 入力内容
- 案件情報（クライアント・担当）
- 開発規模（small / medium / large）
- 画面数（min / max）
- 機能要件
  - 認証
  - RBAC
  - CRUD
  - 検索
  - 外部連携 等
- 非機能要件
  - 性能
  - セキュリティ
  - 運用
- スコープ
  - 含む / 含まない
  - 前提
  - リスク

※ 入力内容は JSON payload として保存する。

---

## 7. 見積仕様（computeEstimate）

### 7.1 ベース画面数
| 規模 | ベース画面数 |
|---|---:|
| small | 12.5 |
| medium | 27.5 |
| large | 45 |

### 7.2 計算ルール
- 画面係数
```txt
screenFactor = clamp(screenAvg / baseScreen, 0.8, 1.6)
